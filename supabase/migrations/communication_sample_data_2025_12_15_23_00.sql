-- إضافة البيانات التجريبية لنظام الرسائل والتواصل

-- إضافة قنوات التواصل للمشاريع
INSERT INTO public.project_channels_2025_12_15_23_00 (
    project_id,
    name,
    description,
    channel_type,
    created_by
) VALUES 
-- قنوات للمشروع الأول
('11111111-1111-1111-1111-111111111111', 'عام', 'قناة المناقشات العامة للمشروع', 'general', '11111111-1111-1111-1111-111111111111'),
('11111111-1111-1111-1111-111111111111', 'الإعلانات', 'قناة الإعلانات والتحديثات المهمة', 'announcements', '11111111-1111-1111-1111-111111111111'),
('11111111-1111-1111-1111-111111111111', 'التقني', 'مناقشات تقنية ومطورين', 'technical', '22222222-2222-2222-2222-222222222222'),
('11111111-1111-1111-1111-111111111111', 'العميل', 'تواصل مع العميل', 'client', '33333333-3333-3333-3333-333333333333'),

-- قنوات للمشروع الثاني
('22222222-2222-2222-2222-222222222222', 'عام', 'قناة المناقشات العامة للمشروع', 'general', '11111111-1111-1111-1111-111111111111'),
('22222222-2222-2222-2222-222222222222', 'الفريق', 'مناقشات الفريق الداخلية', 'team', '22222222-2222-2222-2222-222222222222');

-- إضافة أعضاء القنوات
INSERT INTO public.channel_members_2025_12_15_23_00 (
    channel_id,
    user_id,
    role
) 
SELECT 
    c.id,
    '11111111-1111-1111-1111-111111111111',
    'admin'
FROM public.project_channels_2025_12_15_23_00 c
WHERE c.name = 'عام';

INSERT INTO public.channel_members_2025_12_15_23_00 (
    channel_id,
    user_id,
    role
) 
SELECT 
    c.id,
    '22222222-2222-2222-2222-222222222222',
    'member'
FROM public.project_channels_2025_12_15_23_00 c
WHERE c.channel_type IN ('general', 'technical');

INSERT INTO public.channel_members_2025_12_15_23_00 (
    channel_id,
    user_id,
    role
) 
SELECT 
    c.id,
    '33333333-3333-3333-3333-333333333333',
    'member'
FROM public.project_channels_2025_12_15_23_00 c
WHERE c.channel_type IN ('general', 'client');

-- إضافة الرسائل
INSERT INTO public.project_messages_2025_12_15_23_00 (
    project_id,
    sender_user_id,
    recipient_user_id,
    subject,
    content,
    message_type,
    priority
) VALUES 
-- رسائل عامة للمشروع
('11111111-1111-1111-1111-111111111111', '11111111-1111-1111-1111-111111111111', NULL, 
 'بداية المشروع', 'مرحباً بالجميع! نبدأ اليوم العمل على مشروع تطوير منصة إدارة السياسات والإجراءات. أتطلع للعمل معكم جميعاً.', 
 'announcement', 'high'),

('11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222', NULL,
 'تحديث التصميم', 'تم الانتهاء من تصميم واجهة المستخدم الأولية. يرجى مراجعتها وإبداء الملاحظات.', 
 'update', 'normal'),

('11111111-1111-1111-1111-111111111111', '33333333-3333-3333-3333-333333333333', '11111111-1111-1111-1111-111111111111',
 'استفسار حول المتطلبات', 'لدي بعض الاستفسارات حول متطلبات النظام. هل يمكننا ترتيب اجتماع لمناقشتها؟', 
 'question', 'normal'),

-- رسائل للمشروع الثاني
('22222222-2222-2222-2222-222222222222', '11111111-1111-1111-1111-111111111111', NULL,
 'مراجعة قاعدة البيانات', 'تم الانتهاء من تصميم قاعدة البيانات. نحتاج لمراجعة فنية من الفريق التقني.', 
 'update', 'high'),

('22222222-2222-2222-2222-222222222222', '44444444-4444-4444-4444-444444444444', '11111111-1111-1111-1111-111111111111',
 'ملاحظات على التصميم', 'لدي بعض الملاحظات على تصميم قاعدة البيانات. يرجى إضافة فهارس للأداء.', 
 'issue', 'normal'),

-- رسائل خاصة
('11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222', '33333333-3333-3333-3333-333333333333',
 'تحديث الجدول الزمني', 'مرحباً، أردت إعلامك بأن هناك تأخير طفيف في تسليم التصميم بسبب طلبات التعديل الإضافية.', 
 'update', 'normal'),

('11111111-1111-1111-1111-111111111111', '33333333-3333-3333-3333-333333333333', '22222222-2222-2222-2222-222222222222',
 'شكر وتقدير', 'شكراً لك على الجهد المبذول في التصميم. النتيجة ممتازة!', 
 'general', 'low');

-- إضافة ردود على الرسائل
INSERT INTO public.project_messages_2025_12_15_23_00 (
    project_id,
    sender_user_id,
    recipient_user_id,
    content,
    message_type,
    priority,
    reply_to_message_id
) 
SELECT 
    '11111111-1111-1111-1111-111111111111',
    '11111111-1111-1111-1111-111111111111',
    '33333333-3333-3333-3333-333333333333',
    'بالطبع! يمكننا ترتيب اجتماع غداً في الساعة 2 ظهراً. سأرسل لك رابط الاجتماع.',
    'general',
    'normal',
    m.id
FROM public.project_messages_2025_12_15_23_00 m
WHERE m.subject = 'استفسار حول المتطلبات'
LIMIT 1;

INSERT INTO public.project_messages_2025_12_15_23_00 (
    project_id,
    sender_user_id,
    recipient_user_id,
    content,
    message_type,
    priority,
    reply_to_message_id
) 
SELECT 
    '22222222-2222-2222-2222-222222222222',
    '11111111-1111-1111-1111-111111111111',
    '44444444-4444-4444-4444-444444444444',
    'شكراً للملاحظات القيمة. سأقوم بإضافة الفهارس المطلوبة في الإصدار القادم.',
    'general',
    'normal',
    m.id
FROM public.project_messages_2025_12_15_23_00 m
WHERE m.subject = 'ملاحظات على التصميم'
LIMIT 1;

-- إضافة حالة قراءة الرسائل
INSERT INTO public.message_read_status_2025_12_15_23_00 (
    message_id,
    user_id
) 
SELECT 
    m.id,
    '11111111-1111-1111-1111-111111111111'
FROM public.project_messages_2025_12_15_23_00 m
WHERE m.sender_user_id != '11111111-1111-1111-1111-111111111111'
LIMIT 3;

INSERT INTO public.message_read_status_2025_12_15_23_00 (
    message_id,
    user_id
) 
SELECT 
    m.id,
    '22222222-2222-2222-2222-222222222222'
FROM public.project_messages_2025_12_15_23_00 m
WHERE m.sender_user_id != '22222222-2222-2222-2222-222222222222'
LIMIT 2;

-- إضافة الإشعارات
INSERT INTO public.project_notifications_2025_12_15_23_00 (
    project_id,
    user_id,
    notification_type,
    title,
    content,
    related_entity_type,
    related_entity_id
) VALUES 
('11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222', 'message', 
 'رسالة جديدة من مدير المشروع', 'لديك رسالة جديدة حول بداية المشروع', 'message', 
 (SELECT id FROM public.project_messages_2025_12_15_23_00 WHERE subject = 'بداية المشروع' LIMIT 1)),

('11111111-1111-1111-1111-111111111111', '33333333-3333-3333-3333-333333333333', 'message', 
 'رد على استفسارك', 'تم الرد على استفسارك حول المتطلبات', 'message', 
 (SELECT id FROM public.project_messages_2025_12_15_23_00 WHERE reply_to_message_id IS NOT NULL LIMIT 1)),

('22222222-2222-2222-2222-222222222222', '44444444-4444-4444-4444-444444444444', 'review', 
 'مراجعة جديدة مطلوبة', 'لديك مراجعة جديدة لقاعدة البيانات', 'review', 
 '22222222-2222-2222-2222-222222222222'),

('11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222', 'deadline', 
 'اقتراب موعد التسليم', 'موعد تسليم التصميم بعد يومين', 'deliverable', 
 '11111111-1111-1111-1111-111111111111'),

('22222222-2222-2222-2222-222222222222', '11111111-1111-1111-1111-111111111111', 'assignment', 
 'مهمة جديدة', 'تم تعيين مهمة جديدة لك في المشروع', 'deliverable', 
 '22222222-2222-2222-2222-222222222222');